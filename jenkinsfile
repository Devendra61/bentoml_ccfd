node {
         stage("Git Clone"){

         git credentialsId: 'Git-hub-Credentials', url: ""
   
         stage("Docker build"){
             sh 'docker version'
             sh 'pip install -r requirements.txt'
             sh 'python3 train.py'
             sh 'bentoml build .'
             sh 'bentoml containerize tag xgb_classifier:$BUILD_NUMBER dockerhubid/xgb_classifier:$BUILD_NUMBER'

         }

          withcredentials([string(credentialsid:'Docker-Hub-Password', variable: 'PASSWORD')]){
             sh 'docker login -u dockerhubid p $PASSWORD'
          }

          stage("Push image to docker hub"){
             sh 'docker push dockerhubid/xgb_classifier:$BUILD_NUMBER'
          }

          stage("Kubernetes deployment"){
             sh 'sed -i "s/ BUILD_NUMBER /${BUILD_NUMBER}/" deploymentservice.yaml'
             sh 'kubectl apply -f deploymentservice.yaml'
           }

           stage("Cleanup resources"){
             sh 'echo cleanup'
             sh "docker rmi dockerhubid/xgb_classifier:${BUILD_NUMBER}"
             SH "docker rmi dockerhubid"
            }
        }
    }
